<!DOCTYPE html>
<html>
<head>
	<title>Rotten Eggs</title>
	<link rel='stylesheet' href='/stylesheets/bootstrap.min.css' />
	<script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.3.14/angular.min.js"></script>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" integrity="sha512-dTfge/zgoMYpP7QbHy4gWMEGsbsdZeCXz7irItjcC3sPUFtf0kuFbDz/ixG7ArTxmDjLXDmezHubeNikyKGVyQ==" crossorigin="anonymous">
	<!-- Optional theme -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css" integrity="sha384-aUGj/X2zp5rLCbBxumKTCw2Z50WgIr1vs/PFN4praOTvYXWlVyh2UtNUU0KAUhAX" crossorigin="anonymous">
	<!-- Latest compiled and minified JavaScript -->
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js" integrity="sha512-K1qjQ+NcF2TYO/eI3M6v8EiNYZfA95pQumfvcVrTHtwQVDG+aHRqLi/ETn2uB+1JqwYqVG3LIvdm9lj6imS/pQ==" crossorigin="anonymous"></script>
	<link rel='stylesheet' href='/stylesheets/style.css' />
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
	<script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
	<link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">

	<link rel='stylesheet' href='/stylesheets/style.css' />
</head>
<body>
	<div class="container-fluid">
		<div class="jumbotron">
			<h1>Rotten Eggs</h1>
		</div>
		<nav class="navbar navbar-inverse">
			<div class="container-fluid">
				<div class="navbar-header">
					<a class="navbar-brand" href="/">Rotten Eggs</a>
				</div>
				<div>
					<ul class="nav navbar-nav">
						<li class="active"><a href="/">Home</a></li>
						<% if(user == null){ %>
						<li><a href="/login"> Your Account</a></li> 
						<% }
						else { %>
						<li><a href="/profile"> Your Account</a></li> 
						<% } %>
					</ul>
					
					<form class="navbar-form navbar-left" role="search" id="SelectMovies" name='moviesKeyword' action="/getMovies" method="get">
						<div class="form-group">
							<input type="text" class="form-control" name="movie" placeholder="Bing&RottenEggs">
						</div>
						<button type="submit" class="btn btn-primary">Search</button>
					</form>
					
					
					<ul class="nav navbar-nav navbar-right">
						<% if(user == null){ %>
						
						<li><p class="navbar-text">Already have an account?</p></li>
						<li class="dropdown">
							<a href="/login" class="dropdown-toggle" data-toggle="dropdown"><b>Login</b> <span class="caret"></span></a>
							<ul id="login-dp" class="dropdown-menu">
								<li>
									<div class="row">
										<div class="col-md-12">
											Login via
											<div class="social-buttons">
												<a href="/auth/facebook" class="btn btn-fb"><i class="fa fa-facebook"></i> Facebook</a>
											</div>
											or
											<br>
											<form class="form" role="form" method="post" action="login" accept-charset="UTF-8" id="login-nav">
												<div class="form-group">
													<label class="sr-only" for="exampleInputEmail2">Username</label>
													<input type="text" class="form-control" name="username" id="exampleInputEmail2" placeholder="Username" required>
													<!-- <input type="email" class="form-control" id="exampleInputEmail2" placeholder="Email address" required> -->
												</div>
												<div class="form-group">
													<label class="sr-only" for="exampleInputPassword2">Password</label>
													<input type="password" class="form-control" name="password" id="exampleInputPassword2" placeholder="Password" required>
													<!-- <input type="password" class="form-control" id="exampleInputPassword2" placeholder="Password" required> -->
												</div>
												<div class="form-group">
													<button type="submit" class="btn btn-primary btn-block">Sign in</button>
												</div>
											</form>
										</div>
										<div class="bottom text-center">
											New here ? <a href="/signup"><b>Join Us! Sign up</b></a>
										</div>
									</div>
								</li>
							</ul>
						</li>
						<% }
						else { %>
						<li><a href="/logout">Log out</a></li>
						<% } %>
					</ul>
<!--         <ul class="nav navbar-nav navbar-right">
        	<% if(user == null){ %>
        	<li><a href="/login">Sign In</a></li>
        	<li><a href="/signup">Sign Up</a></li>
        	<li><a href="/auth/facebook" class="btn btn-primary"><span class="fa fa-facebook"></span> Facebook</a></li>
        	<% }
        	else { %>
        	<li><a href="/logout">Log out</a></li>
        	<% } %>
        </ul> -->
    </div>
</div>
</nav>
<div id="wrapper">


	<!-- Navigation -->

	<div class="navbar-default sidebar" role="navigation">
		<div class="sidebar-nav navbar-collapse">

			<form id="typeSelectForm" name='selectGenre' action="/getGenre" method="get" style="float:center">
				<div class="leftlist">
					<input class="button" name="g" type="submit" value="<%= 'Action'%>">
				</div>
				<div class="leftlist">
					<input class="button" name="g" type="submit" value="<%= 'Adventure'%>">
				</div>
				<div class="leftlist">
					<input class="button" name="g" type="submit" value="<%= 'Animation'%>">
				</div>
				<div class="leftlist">
					<input class="button" name="g" type="submit" value="<%= 'Comedy'%>">
				</div>
				<div class="leftlist">
					<input class="button" name="g" type="submit" value="<%= 'Crime'%>">
				</div>
				<div class="leftlist">
					<input class="button" name="g" type="submit" value="<%= 'Documentary'%>">
				</div>
				<div class="leftlist">
					<input class="button" name="g" type="submit" value="<%= 'Drama'%>">
				</div>
				<div class="leftlist">
					<input class="button" name="g" type="submit" value="<%= 'Family'%>">
				</div>
				<div class="leftlist">
					<input class="button" name="g" type="submit" value="<%= 'Fantasy'%>">
				</div>
				<div class="leftlist">
					<input class="button" name="g" type="submit" value="<%= 'Foreign'%>">
				</div>
				<div class="leftlist">
					<input class="button" name="g" type="submit" value="<%= 'History'%>">
				</div>
				<div class="leftlist">
					<input class="button" name="g" type="submit" value="<%= 'Horror'%>">
				</div>
				<div class="leftlist">
					<input class="button" name="g" type="submit" value="<%= 'Kids'%>">
				</div>
				<div class="leftlist">
					<input class="button" name="g" type="submit" value="<%= 'Music'%>">
				</div>
				<div class="leftlist">
					<input class="button" name="g" type="submit" value="<%= 'Mystery'%>">
				</div>
				<div class="leftlist">
					<input class="button" name="g" type="submit" value="<%= 'Romance'%>">
				</div>
				<div class="leftlist">
					<input class="button" name="g" type="submit" value="<%= 'Science Fiction'%>">
				</div>
				<div class="leftlist">
					<input class="button" name="g" type="submit" value="<%= 'Thriller'%>">
				</div>
				<div class="leftlist">
					<input class="button" name="g" type="submit" value="<%= 'TV Movie'%>">
				</div>
				<div class="leftlist">
					<input class="button" name="g" type="submit" value="<%= 'War'%>">
				</div>
				<div class="leftlist">
					<input class="button" name="g" type="submit" value="<%= 'Western'%>">
				</div>
			</form>
		</div>
		<!-- /.sidebar-collapse -->
	</div>
	<!-- /.navbar-static-side -->
</nav>

<div id="page-wrapper">	
	<div class="container">
		<% if(bing !=null && resultsperson!=null && resultsmovie!=null) { %>
		<h2>Bing Results</h2>  
		<table class="table">
			<thead>
				<tr>
					<th>Results</th>
					<th>Description</th>
				</tr>
			</thead>
			<tbody>
				<% for(var i=0; i<bing.length; i++) { %>
				<tr>
					<form id="movieSelectForm" name='selectMovie' action="/getMovie" method="get" style="float:center">
						<td><a href=<%= bing[i].Url%> > <%= bing[i].Title%> </a></td>
						<td><%= bing[i].Description%></td>						
					</form>
				</tr> 
				<% } %>
			</tbody>
		</table>

		<h2>Database Results</h2>
		<table class="table" width=100% cellpadding=0 cellspacing=0 style='table-layout:fixed'>
			<thead>
				<tr>
					<th>Name</th>
					<th>biography</th>
				</tr>
			</thead>
			<tbody>
				<% for(var i=0; i<resultsperson.length; i++) { %>
				<tr>
					<form id="movieSelectForm" name='selectMovie' action="/linktoperson" method="get" style="float:center">
						<% var poster=resultsperson[i].profile.replace(/"/g, "") %>
						<td style='text-overflow: ellipsis; overflow: hidden; white-space: nowrap;'>
							<button type="submit" class="btn btn-link" name="personid" value = <%= resultsperson[i].personid%> ><%= resultsperson[i].name.replace(/"/g, "")%></button></td>
							<% var s= resultsperson[i].biography.replace(/"/g, "") %>
							<% if(s.length<5) {%>
							<td> No Details</td> <% } else {%>
							<td style='text-overflow: ellipsis; overflow: hidden; white-space: nowrap;'> <%= s %></td>
							<% } %>
						</form>
					</tr> 
					<% } %>
					<% for(var i=0; i<resultsmovie.length; i++) { %>
					<tr>
						<form id="movielinkform" name='linktomovie' action="/linktomovie" method="get" style="float:center">
							<td style='text-overflow: ellipsis; overflow: hidden; white-space: nowrap;'><button type="submit" class="btn btn-link" name="movieid" value = <%= resultsmovie[i].movie_id%> ><%= resultsmovie[i].title.replace(/"/g, "")%></button></td>
							<td style='text-overflow: ellipsis; overflow: hidden; white-space: nowrap;'><%= resultsmovie[i].overview.replace(/"/g, "")%></td>
						</form>
					</tr> 
					<% } %>
				</tbody>
			</table>
			<% } %> <!--end of if-->
			<!--if results == null randomly return 10 bad movies here-->

			<% if(results==null){ %>
		</div>	
		<% } 
		else { %>
		<% for(var i=0; i<results.length; i++) { %>

		<% if(i%3==0 && i!=0) { %>
	</div>
	<% } %>	
	<% if(i%3==0) { %>
	<div class="row">
		<% } %>	
		<div class="col-sm-6 col-md-3">
			<div class="thumbnail">
				<% if(user == null){ %>
				<form id="movielinkform" name='linktomovie' action="/linktomovie" method="get" style="float:center">
					<% var poster=results[i].poster.replace(/"/g, "") %>
					<input type=image src=<%= poster %>  name= "movieid" alt="..." style="width:160px;height:228px;" value= <%= results[i].movie_id%> >
				</form>
				<form id="movieSelectForm" name='selectMovie' action="/login" method="get" style="float:center">
					<p id="overflow"><%= results[i].title.replace(/"/g, "")%></p>
					<button type="submit" class="vote-button" name="movieid" value = <%= results[i].movie_id%> ></button>
				</form>
				<% } else { %>
				<form id="movielinkform" name='linktomovie' action="/linktomovie" method="get" style="float:center">
					<% var poster=results[i].poster.replace(/"/g, "") %>
					<input type=image src=<%= poster %> name="movieid" alt="..." style="width:160px;height:228px;" value= <%= results[i].movie_id%> >
				</form>
				<% if(hasvoted.indexOf(results[i].movie_id)!= -1){ %>
				<form id="movieSelectForm" name='selectMovie' action="/unvote" method="get" style="float:center">
					<p id="overflow"><%= results[i].title.replace(/"/g, "")%></p>
					<button type="submit" class="btn btn-primary" name="movieid" value = <%= results[i].movie_id%> > Unvote</button>
				</form>
				<% }
				else { %>
				<form id="movieSelectForm" name='selectMovie' action="/vote" method="get" style="float:center">
					<p id="overflow"><%= results[i].title.replace(/"/g, "")%></p>
					<button type="submit" class="vote-button" name="movieid" value = <%= results[i].movie_id%> ></button>
				</form>
				<% } }%>
			</div>
		</div>
		<% } %>
	</div>
	<% } %>	
	<form id="movieSelectForm" name='selectMovie' action="/loadmore" method="get" style="float:center">
		<button type="submit" class="btn btn-primary" name="limitnum" value = <%=limitnum%> > Load more</button>
	</form>
	<br>


	<div class="container">
		<% if( recentvote !=null) { %> 
		<h2>Recent Vote</h2>
		<!-- Table -->
		<table class="table">
			<thead>
				<tr>
					<th>Movie ID</th>
					<th>User ID</th>
					<th>Timestamp</th>
				</tr>
			</thead>
			<tbody>
				<% for(var i=0; i<recentvote.length; i++) { %>
				<tr>
					<form id="movieSelectForm" name='selectMovie' action="/getMovie" method="get" style="float:center">
						<td><%= recentvote[i].movieid %></td>
						<td><%= recentvote[i].userid %></td>
						<td><%= recentvote[i].ts %></td>						
					</form>
				</tr> 
				<% } %>
			</tbody>
		</table>
		
		<% } %>

		<% if( currentworst!=null ) { %>
		<h2>Current Worst Movies</h2>
		<table class="table">
			<thead>
				<tr>
					<th>Rank</th>
					<th>Name</th>
					<th>Votes</th>
					<th>User Rating</th>
				</tr>
			</thead>
			<tbody>
				<% for(var i=0; i<currentworst.length; i++) { %>
				<tr>
					<form id="movieSelectForm" name='selectMovie' action="/getMovie" method="get" style="float:center">
						<td><%= i+1 %></td>
						<td><%= currentworst[i].title.replace(/"/g, "")%></td>
						<td><%= currentworst[i].vote %></td>
						<td><%= currentworst[i].userrating %></td>
					</form>
				</tr> 
				<% } %>
			</tbody>
		</table>
		<% } %> <!--end of if-->
		<!--if results == null randomly return 10 bad movies here-->
	</div>

</div>
<!-- /#page-wrapper -->
</div>
<!-- /#wrapper -->
</div>
</body>
</html>
